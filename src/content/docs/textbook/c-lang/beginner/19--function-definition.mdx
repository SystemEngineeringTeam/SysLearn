---
title : 自作関数の設計
slug: http://localhost:4321/textbook/c-lang/beginner/function-definition
---

import { Aside } from '@astrojs/starlight/components';
import { Tabs, TabItem } from '@astrojs/starlight/components';
import { Card } from '@astrojs/starlight/components';


プログラムは、多くの機能の組合わせによって構成されます。
ひとつひとつの機能を提供する基本単位が関数になります。
自作関数の設計について学んでいきましょう。


## 関数定義と関数呼出し
---

**関数**（function）とは、値を引数として受け取り、何らかの処理を行う命令のことを指します。
特に、今まで扱ってきた`printf`関数や`puts`関数、`scanf`関数などは、C言語によって標準で提供されており、これを**ライブラリ関数**（library function）と呼びます。

実は、関数は自作することができます。
まずは、関数定義について確認していきましょう。

関数定義は次のようにして実現することができます。

```c
返却値型 関数名(仮引数型並び) {
    処理の内容
    return 返却値
}
```

なお、呼び出される関数は、呼び出す箇所よりも上の行に記述される必要があります。
そのため、関数定義は`main`関数よりも上の行に記述しましょう。

例として、２つの整数値を受け取り、最大値を返す関数を作成してみましょう。

```c title="list19_01.c"
#include <stdio.h>

int max2(int n1, int n2) {
    if (n1 > n2)
        return n1;
    else
        return n2;
}

int main(void) {
    int a = 3;
    int b = 7;
    
    printf("max: %d\n", max2(a, b));
    
    return 0;
}
```

**実行結果**
```
max: 7
```

`main`関数上に、`max2`関数を定義しました。

`main`関数内にて、実引数`a, b`を与えて`max2`関数を呼び出しています。
次に、仮引数`n1, n2`には実引数の値が代入され、自作関数内の処理へと進みます。
最後に、関数呼出しの式`max2(a, b)`は、２値の比較によって返却された値に置換され、実行されます。

また、`return`文は関数の実行を終了して、プログラムの流れを呼出し元に戻すとともに値を返却する仕組みであることを覚えておきましょう。

<Aside type="note" title="関数定義">
```c
返却値型 関数名(仮引数型並び) {
    処理の内容
    return 返却値
}
```
</Aside>


## 自作関数内での関数呼出し
---

関数を組み合わせることで、プログラムを少ない記述量で実現することができます。

例として、次の４つの整数値の最大値を求めるプログラム`list17_02`をみてみましょう。

```c title="list19_02.c"
#include <stdio.h>

int max2(int n1, int n2) {
    if (n1 > n2)
        return n1;
    else
        return n2;
}

int max4(int n1, int n2, int n3, int n4) {
    return max2(max2(n1, n2), max2(n3, n4));
}

int main(void) {
    int a = 3;
    int b = 7;
    int c = 2;
    int d = 5;
    
    printf("max: %d\n", max4(a, b, c, d));
    
    return 0;
}
```

**実行結果**
```
max: 7
```

プログラムの処理の流れは、次のとおりです。

1. `main`関数から処理が始まり、変数`a, b, c, d`を定義
2. `max4(a, b, c, d)`を呼び出す
3. `max2(n1, n2)`と`max2(n3, n4)`を呼び出す
4. `max2(n1, n2)`と`max2(n3, n4)`の戻り値を実引数として、`max2(max2(n1, n2), max2(n3, n4))`が呼び出される
5. ４値の最大値を戻り値として、`max4(a, b, c, d)`に置換され、結果を出力する

プログラムの処理の流れと戻り値に注意して、関数を活用していきましょう。


## 引数を受け取らない関数
---

受け取る仮引数がない関数を定義する場合、仮引数型並びを`void`（『空の』を意味します）とします。
実際に、次のプログラム`list19_03.c`を確認してみましょう。

```c title="list19_03.c"
#include <stdio.h>

// 自然数を標準入力によって受け取り返却する関数
int scanN(void) {
    int n;
    
    do {
        printf("natural number? ");
        scanf("%d", &n);
        
        if (n <= 0)
            printf("error!\n");
    } while (n <= 0);
    
    return n;
}

int main(void) {
    // 関数の呼出し
    int n = scanN();
    
    printf("n: %d\n", n);
    
    return 0;
}
```

**実行結果**
```
natural number? 0
error!
natural number? -3
error!
natural number? 5
n: 5
```

`scanN`関数は、主に自然数を標準入力によって受け取り返却する関数になります。
そのため、仮引数を必要としません。

このような関数を設計する場合、仮引数並びとして`void`を記述することを忘れないようにしましょう。

<Aside type="note" title="引数を受け取らない関数の定義">
```c
返却値型 関数名(void) {
    処理の内容
    return 返却値;
}
```
</Aside>


## 値を返さない関数
---

値を返さない関数を定義する場合も、関数型を`void`とします。
実際に、次のプログラム`list19_04.c`を確認してみましょう。

```c title="list19_04.c"
#include <stdio.h>

// 自然数を標準入力によって受け取り返却する関数
int scanN(void) {
    int n;
    
    do {
        printf("natural number? ");
        scanf("%d", &n);
        
        if (n <= 0)
            printf("error!\n");
    } while (n <= 0);
    
    return n;
}

// 与えた整数値だけ * を出力する関数
void putStars(int n) {
    for (int i = 0; i < n; i++)
        putchar('*');
    putchar('\n');  // 改行
}

int main(void) {
    putStars(scanN());
    
    return 0;
}
```

**実行結果**
```
natural number? 0
error!
natural number? -3
error!
natural number? 5
*****
```

`printStars`関数は、与えた整数値だけ`*`を出力する関数になります。
そのため、戻り値は存在しません。

このような関数を設計する場合、返却値型として`void`を記述することを忘れないようにしましょう。

<Aside type="note" title="値を返さない関数の定義">
```c
void 関数名(仮引数型並び) {
    処理の内容
}
```
</Aside>


## 関数原型宣言
---

コンパイラがプログラムを先頭から末尾へと読み進める都合上、関数の定義は、その関数を呼び出す箇所よりも上の行に記述する必要がありました。
実は、関数を宣言することによって、関数の定義を呼出し箇所よりも下の行に記述することができます。

この宣言は、関数の使用ともいうべき、関数の返却値型／関数名／仮引数を記述する必要があることから、**関数原型宣言**（function prototype declaration）と呼ばれます。

実際に、プログラム`list19_01.c`を、関数原型宣言を用いて書き換えましょう。

```c title="list19_05.c" {3}
#include <stdio.h>

int max2(int, int);

int main(void) {
    int a = 3;
    int b = 7;
    
    printf("max: %d\n", max2(a, b));
    
    return 0;
}

int max2(int n1, int n2) {
    if (n1 > n2)
        return n1;
    else
        return n2;
}
```

関数の使用に関する宣言を`main`関数の上部に記述したことで、`main`関数の下部に関数の実体の定義を記述することができました。


<Card>
### 練習問題1

次のプログラムの`TODO`を補うことで、実行結果に合うように関数を呼出してください。

```c
#include <stdio.h>

// 与えた整数値だけ * を出力する関数
void putStars(int n) {
    for (int i = 0; i < n; i++)
        putchar('*');
    putchar('\n');  // 改行
}

int main(void) {
    int n = 5;
    
    // TODO: ループ文などを用いて putStars 関数を呼出してください
    
    return 0;
}
```

**実行結果**
`n = 1`のとき、
```
*
```

`n = 3`のとき、
```
*
**
***
```

`n = 5`のとき、
```
*
**
***
****
*****
```
ファイル名: `19_issue1.c`
<details>
<summary>ヒント</summary>
<Aside type="tip">
１行目は`*`を１つ、２行目は`*`を２つ、......、`n`行目は`*`を`n`つ印字するようにしたいです。

関数の呼出しを`for`文の中に記述することで、`*`の数を制御してください。

```c
for (/* TODO: ここにプログラムを記述してください */) {
    putStars(i);
}
```
</Aside>
</details>
<details>
<summary>模範解答</summary>
```c title="19_issue1.c"
#include <stdio.h>

// 与えた整数値だけ * を出力する関数
void putStars(int n) {
    for (int i = 0; i < n; i++)
        putchar('*');
    putchar('\n');  // 改行
}

int main(void) {
    int n = 5;
    
    for (int i = 1; i <= n; i++) {
        putStars(i);
    }
    
    return 0;
}
```
</details>
</Card>


<Card>
### 練習問題2

自然数`n`を受け取り、その階乗`n!`を算出する関数`factorial`を作成してください。

なお、階乗`n!`とは、`1`から`n`までの自然数の積のことを指します。

```c
#include <stdio.h>

// 与えられた整数値の階乗を求める関数
int factorial(int n) {
    // TODO: ここにプログラムを記述してください
}

void issue1902(int n) {
    printf("%d! = %d\n", n, factorial(n));
}

int main(void) {
    int n = 5;
    
    issue1902(n);
    
    return 0;
}
```

**実行結果**
```
1! = 1
```
```
5! = 120
```
```
10! = 3628800
```
ファイル名: `19_issue2.c`
<details>
<summary>ヒント</summary>
<Aside type="tip">
階乗を求めるには、初期値が`1`の変数に対して順々に整数値を掛けていくことで実現します。

```c
int ans = 1;  // 初期値を 1 とする
    
for (int i = 1; i <= n; i++) {
    ans *= i;
}
```
</Aside>
</details>
<details>
<summary>模範解答</summary>
```c title="19_issue2.c"
#include <stdio.h>

// 与えられた整数値の階乗を求める関数
int factorial(int n) {
    int ans = 1;  // 初期値を 1 とする
    
    for (int i = 1; i <= n; i++) {
        ans *= i;
    }
    
    return ans;
}

void issue1902(int n) {
    printf("%d! = %d\n", n, factorial(n));
}

int main(void) {
    int n = 5;
    
    issue1902(n);
    
    return 0;
}
```
</details>
</Card>
